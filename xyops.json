{
	"type": "xypdf",
	"description": "xyOps Portable Data Object",
	"version": "1.0",
	"items": [
		{
			"type": "plugin",
			"data": {
				"id": "pmkiue8906n0zvg0",
				"title": "PowerShell",
				"enabled": true,
				"type": "event",
				"command": "pwsh",
				"script": "<#\n.SYNOPSIS\n\txyOps PowerShell event plugin - Executes PowerShell commands within the xyOps environment.\n\n.NOTES\n\tAuthor:         Nick Dollimount\n\tContributor:    Tim Alderweireldt\n\tCopyright:      2026\n\tPurpose:        xyOps PowerShell event plugin\n\tFeatures:       - Cross-platform compatibility\n                    - Comprehensive helper functions for xyOps integration\n\t\t\t\t\t\n\tPlease see the README.md file for full documentation of each function, including examples.\n#>\n\n# MARK: Write-xyOpsJobOutput\nfunction Write-xyOpsJobOutput {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, Position = 0, ValueFromPipeline = $true)][string]$Message,\n\t\t[Parameter(Mandatory = $false)][ValidateSet('info', 'warning', 'error')][string]$Level = 'info'\n\t)\n\n\tif ($Script:enableLogTime -eq $true) {\n\t\t$timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss:ffff\"\n\t\t$logMessage = \"[$($timestamp)] [$($Level)] $($Message)\"\n\t}\n\telse {\n\t\t$logMessage = \"[$($Level)] $($Message)\"\n\t}\n\n\tSend-xyOpsOutput $logMessage\n}\n\n# MARK: Send-xyOpsOutput\nfunction Send-xyOpsOutput {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][object]$InputObject\n\t)\n\n\ttry {\n\t\tWrite-Information -MessageData (($InputObject -is [string]) ? $InputObject : ($InputObject | ConvertTo-Json -Depth 100 -Compress)) -InformationAction Continue -OutBuffer 0\n\t}\n\tcatch {\n\t\tThrow \"Unsupported data type.\"\n\t}\n}\n\n# MARK: Send-xyOpsProgress\nfunction Send-xyOpsProgress {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][decimal]$Percent,\n\t\t[Parameter(Mandatory = $false, ValueFromPipeline = $true, Position = 1)][string]$Status\n\t)\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy       = 1\n\t\t\tprogress = $Percent / 100\n\t\t\tstatus   = $Status\n\t\t})\n}\n\n# MARK: Send-xyOpsStatus\nfunction Send-xyOpsStatus {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$Status\n\t)\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy     = 1\n\t\t\tstatus = $Status\n\t\t})\n}\n\n# MARK: New-Filename\nfunction New-Filename {\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)]$Filetype,\n\t\t[Parameter(Mandatory = $false)]$Prefix\n\t)\n\n\t$prefix = $Prefix -replace \" \", \"_\"\n\t$guid = (New-Guid).Guid\n\n\t$filename = \"$((![string]::IsNullOrEmpty($prefix)) ? \"$($prefix)_\" : $null)$($guid).$($fileType)\"\n\treturn $filename\n}\n\n# MARK: Send-xyOpsFile\nfunction Send-xyOpsFile {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Filename\n\t)\n\n\t$output = [pscustomobject]@{\n\t\txy    = 1\n\t\tfiles = @(\n\t\t\t@{\n\t\t\t\tpath   = $Filename\n\t\t\t\tdelete = $false\n\t\t\t}\n\t\t)\n\t}\n\n\tSend-xyOpsOutput $output\n}\n\n# MARK: Send-xyOpsPerf\nfunction Send-xyOpsPerf {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][hashtable]$Metrics,\n\t\t[Parameter(Mandatory = $false)][int]$Scale\n\t)\n\n\t$output = [pscustomobject]@{\n\t\txy   = 1\n\t\tperf = $Metrics\n\t}\n\t\n\tif ($Scale) {\n\t\t$output.perf['scale'] = $Scale\n\t}\n\n\tSend-xyOpsOutput $output\n}\n\n# MARK: Send-xyOpsLabel\nfunction Send-xyOpsLabel {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Label\n\t)\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy    = 1\n\t\t\tlabel = $Label\n\t\t})\n}\n\n# MARK: Send-xyOpsData\nfunction Send-xyOpsData {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][object]$Data\n\t)\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\tdata = $Data\n\t\t})\n}\n\n# MARK: Send-xyOpsTable\nfunction Send-xyOpsTable {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][array]$Rows,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][array]$Header,\n\t\t[Parameter(Mandatory = $false)][string]$Caption\n\t)\n\n\t$table = @{\n\t\trows = $Rows\n\t}\n\t\n\tif ($Title) { $table['title'] = $Title }\n\tif ($Header) { $table['header'] = $Header }\n\tif ($Caption) { $table['caption'] = $Caption }\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy    = 1\n\t\t\ttable = $table\n\t\t})\n}\n\n# MARK: Send-xyOpsHtml\nfunction Send-xyOpsHtml {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][string]$Content,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][string]$Caption\n\t)\n\n\t$html = @{\n\t\tcontent = $Content\n\t}\n\t\n\tif ($Title) { $html['title'] = $Title }\n\tif ($Caption) { $html['caption'] = $Caption }\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\thtml = $html\n\t\t})\n}\n\n# MARK: Send-xyOpsText\nfunction Send-xyOpsText {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][string]$Content,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][string]$Caption\n\t)\n\n\t$text = @{\n\t\tcontent = $Content\n\t}\n\t\n\tif ($Title) { $text['title'] = $Title }\n\tif ($Caption) { $text['caption'] = $Caption }\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\ttext = $text\n\t\t})\n}\n\n# MARK: Send-xyOpsMarkdown\nfunction Send-xyOpsMarkdown {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][string]$Content,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][string]$Caption\n\t)\n\n\t$markdown = @{\n\t\tcontent = $Content\n\t}\n\t\n\tif ($Title) { $markdown['title'] = $Title }\n\tif ($Caption) { $markdown['caption'] = $Caption }\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy       = 1\n\t\t\tmarkdown = $markdown\n\t\t})\n}\n\n# MARK: Get-xyOpsInputFiles\nfunction Get-xyOpsInputFiles {\n\t$files = [System.Collections.Generic.List[object]]::new()\n\n\tforeach ($file in $Script:xyOps.input.files) {\n\t\t$files.Add($file)\n\t}\n\t\n\treturn $files\n}\n\n# MARK: Get-xyOpsBucketFile\nfunction Get-xyOpsBucketFile {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename,\n\t\t[Parameter(Mandatory = $false, ValueFromPipeline = $true, Position = 2)][string]$OutFilename\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/get_bucket/v1?id=$($BucketId)\"\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'GET'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t}\n\n\ttry {\n\t\t$bucketData = (Invoke-RestMethod @requestSplat)\n\t}\n\tcatch {\n\t\tthrow \"There was a problem retrieving the specified bucket details.\"\n\t\t$_\n\t}\n\n\tif ([string]::IsNullOrEmpty($bucketData.files)) {\n\t\tWrite-xyOpsJobOutput \"There are no files in specified bucket.\"\n\t\treturn\n\t}\n\n\t$filePath = $bucketData.files.Where({ $_.filename -eq $Filename }).path\n\n\tif ([string]::IsNullOrEmpty($filePath)) {\n\t\tWrite-xyOpsJobOutput \"The requested file does not exist in the specified bucket.\"\n\t\treturn\n\t}\n\n\t$apiUri = \"$($Script:xyOps.base_url)/$($filePath)\"\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'GET'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t}\n\n\ttry {\n\t\tInvoke-RestMethod @requestSplat -OutFile \"./$(($OutFilename) ? $OutFilename : $Filename)\"\n\t}\n\tcatch {\n\t\tthrow \"There was a problem downloading the requested file.\"\n\t\t$_\n\t}\n}\n\n# MARK: Add-xyOpsBucketFile\nfunction Add-xyOpsBucketFile {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/upload_bucket_files/v1?id=$($BucketId)\"\n\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'POST'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t\tForm    = @{\n\t\t\tfile = (Get-Item -Path $Filename)\n\t\t}\n\t}\n\n\ttry {\n\t\tInvoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"File [$($Filename)] uploaded to Bucket [$($BucketId)].\"\n\t}\n\tcatch {\n\t\tthrow \"There was a problem uploading the requested file.\"\n\t\t$_\n\t}\n}\n\n# MARK: Remove-xyOpsBucketFile\nfunction Remove-xyOpsBucketFile {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename\n\t)\n\t\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/delete_bucket_file/v1\"\n\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'POST'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t\tBody    = @{\n\t\t\tid       = $BucketId\n\t\t\tfilename = $Filename\n\t\t}\n\t}\n\n\ttry {\n\t\t$null = Invoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"File [$($Filename)] was deleted from Bucket [$($BucketId)].\"\n\t}\n\tcatch {\n\t\tthrow ($_.ErrorDetails.Message | ConvertFrom-Json)\n\t}\n}\n\n# MARK: Get-xyOpsBucketData\nfunction Get-xyOpsBucketData {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/get_bucket/v1?id=$($BucketId)\"\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'GET'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t}\n\n\ttry {\n\t\t$bucketData = (Invoke-RestMethod @requestSplat).data\n\t}\n\tcatch {\n\t\t$_\n\t}\n\n\treturn $bucketData\n}\n\n# MARK: Set-xyOpsBucketData\nfunction Set-xyOpsBucketData {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Key,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 2)][object]$InputObject\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/write_bucket_data/v1?id=$($BucketId)\"\n\n\t$requestSplat = @{\n\t\tUri         = $apiUri\n\t\tMethod      = 'POST'\n\t\tHeaders     = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t\tContentType = 'application/json'\n\t\tBody        = @{\n\t\t\tdata = [PSCustomObject]@{\n\t\t\t\t\"$($Key)\" = $InputObject\n\t\t\t}\n\t\t} | ConvertTo-Json -Depth 100\n\t}\n\n\ttry {\n\t\t$null = Invoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"Bucket [$($BucketId)] data updated.\"\n\t}\n\tcatch {\n\t\tthrow \"There was an issue updating bucket [$($BucketId)] data.\"\n\t\t$_\n\t}\n}\n\n# MARK: Get-xyOpsCache\nfunction Get-xyOpsCache {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Key\n\t)\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Cache is currently unavailable.\"\n\t}\n\n\t$cacheBucketId = $Script:xyOps.secrets.\"$($Script:xyOps.params.cachebucketidvariable)\"\n\n\ttry {\n\t\t$bucketData = Get-xyOpsBucketData -BucketId $cacheBucketId\n\t\t$cacheData = $bucketData.\"$($Key)\"\n\t}\n\tcatch {\n\t\t$_\n\t}\n\n\treturn $cacheData\n}\n\n# MARK: Set-xyOpsCache\nfunction Set-xyOpsCache {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$Key,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][object]$InputObject\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Cache is currently unavailable.\"\n\t}\n\n\t$cacheApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$cacheBucketId = $Script:xyOps.secrets.\"$($Script:xyOps.params.cachebucketidvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/write_bucket_data/v1?id=$($cacheBucketId)\"\n\n\t$requestSplat = @{\n\t\tUri         = $apiUri\n\t\tMethod      = 'POST'\n\t\tHeaders     = @{\n\t\t\t'X-API-KEY' = $cacheApiKey\n\t\t}\n\t\tContentType = 'application/json'\n\t\tBody        = @{\n\t\t\tdata = [PSCustomObject]@{\n\t\t\t\t\"$($Key)\" = $InputObject\n\t\t\t}\n\t\t} | ConvertTo-Json -Depth 100\n\t}\n\n\ttry {\n\t\t$null = Invoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"Cache [$($Key)] updated.\"\n\t}\n\tcatch {\n\t\tthrow \"There was an issue updating cache [$($Key)].\"\n\t\t$_\n\t}\n}\n\n# MARK: Get-xyOpsParam\nfunction Get-xyOpsParam {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $false)][string]$Name\n\t)\n\n\t# If no name specified, display all parameters\n\tif ([string]::IsNullOrEmpty($Name)) {\n\t\t$paramList = [System.Collections.Generic.List[object]]::new()\n\t\t\n\t\t# Collect environment variables\n\t\t$envVars = [Environment]::GetEnvironmentVariables()\n\t\tforeach ($key in $envVars.Keys) {\n\t\t\t[void]$paramList.Add([PSCustomObject]@{\n\t\t\t\t\tSource = \"Environment\"\n\t\t\t\t\tName   = $key\n\t\t\t\t\tValue  = $envVars[$key]\n\t\t\t\t})\n\t\t}\n\t\t\n\t\t# Collect xyOps params\n\t\tif ($Script:xyOps.params) {\n\t\t\t$Script:xyOps.params.PSObject.Properties | ForEach-Object {\n\t\t\t\t[void]$paramList.Add([PSCustomObject]@{\n\t\t\t\t\t\tSource = \"xyOps\"\n\t\t\t\t\t\tName   = $_.Name\n\t\t\t\t\t\tValue  = $_.Value\n\t\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\t\n\t\t# Display as formatted table\n\t\treturn $paramList | Format-Table -Property Source, Name, Value -AutoSize\n\t}\n\n\t# Check environment variable first (xyOps passes params as env vars)\n\t$envValue = [Environment]::GetEnvironmentVariable($Name)\n\tif ($null -ne $envValue) {\n\t\treturn $envValue\n\t}\n\t\n\t# Check params object\n\tif ($Script:xyOps.params.$Name) {\n\t\treturn $Script:xyOps.params.$Name\n\t}\n\t\n\treturn $null\n}\n\n# MARK: Get-xyOpsTags\nfunction Get-xyOpsTags {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $false, ValueFromPipeline = $true, Position = 0)][System.Collections.Generic.List[string]]$Tags\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Tags access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/get_tags/v1\"\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'GET'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t}\n\n\ttry {\n\t\t$allTags = (Invoke-RestMethod @requestSplat).rows\n\t}\n\tcatch {\n\t\t$_\n\t}\n\n\tif ($Tags) {\n\t\t$returnTags = [System.Collections.Generic.List[object]]::new()\n\n\t\tforeach ($tag in $allTags) {\n\t\t\tif ($tag.title -in $Tags) {\n\t\t\t\t$returnTags.Add($tag)\n\t\t\t}\n\t\t}\n\n\t\treturn $returnTags\n\t}\n\n\treturn $allTags\n}\n\n# MARK: Send-xyOpsTags\nfunction Send-xyOpsTags {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][System.Collections.Generic.List[string]]$Tags\n\t)\n\n\ttry {\n\t\t$systemTags = [System.Collections.Generic.List[object]](Get-xyOpsTags)\n\t}\n\tcatch {\n\t\tthrow $_\n\t}\n\n\t$pushTags = [System.Collections.Generic.List[object]]::new()\n\n\tforeach ($tag in $Tags) {\n\t\tswitch ($tag) {\n\t\t\t{ $_ -in $systemTags.title } {\n\t\t\t\t$pushTags.Add(($systemTags.Find({ $args.title -eq $tag })).id)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\t{ $_ -in $systemTags.id } {\n\t\t\t\t$pushTags.Add($tag)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tdefault {\n\t\t\t\tWrite-xyOpsJobOutput -Message \"[Send-xyOpsTags] The tag '$($tag)' does not exist. Create the tag under [Scheduler > Tags].\"\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\tpush = @{\n\t\t\t\ttags = $pushTags\n\t\t\t}\n\t\t})\n}\n\n# MARK: Send-xyOpsEmail\nfunction Send-xyOpsEmail {\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][string]$To,\n\t\t[Parameter(Mandatory = $true)][string]$Subject,\n\t\t[Parameter(Mandatory = $true)][string]$Body,\n\t\t[Parameter(Mandatory = $false)][System.Collections.Generic.List[object]]$CC,\n\t\t[Parameter(Mandatory = $false)][System.Collections.Generic.List[object]]$BCC,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][string]$ButtonLabel,\n\t\t[Parameter(Mandatory = $false)][string]$ButtonUri,\n\t\t[Parameter(Mandatory = $false)][ValidateSet('low', 'normal', 'high')][string]$Importance = 'normal',\n\t\t[Parameter(Mandatory = $false)][System.Collections.Generic.List[object]]$Attachments\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Email access is currently unavailable.\"\n\t}\n\n\t$apiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.sendemailapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/send_email/v1\"\n\n\t$requestSplat = @{\n\t\tUri         = $apiUri\n\t\tMethod      = 'POST'\n\t\tHeaders     = @{\n\t\t\t'X-API-KEY' = $apiKey\n\t\t}\n\t\tContentType = 'multipart/form-data'\n\t\tForm        = @{\n\t\t\tjson = @{\n\t\t\t\tto      = $To\n\t\t\t\tsubject = $Subject\n\t\t\t\tbody    = $Body\n\t\t\t\tcc      = $CC -join ','\n\t\t\t\tbcc     = $BCC -join ','\n\t\t\t\ttitle   = $Title\n\t\t\t\tbutton  = (-not [string]::IsNullOrEmpty($ButtonLabel) -and -not [string]::IsNullOrEmpty($ButtonUri)) ? \"$($ButtonLabel) | $($ButtonUri)\" : $null\n\t\t\t\theaders = @{\n\t\t\t\t\tImportance          = $Importance\n\t\t\t\t\t'X-MSMail-Priority' = switch ($Importance) {\n\t\t\t\t\t\t'low' { 5 }\n\t\t\t\t\t\t'normal' { 3 }\n\t\t\t\t\t\t'high' { 1 }\n\t\t\t\t\t}\n\t\t\t\t\t'X-Priority'        = switch ($Importance) {\n\t\t\t\t\t\t'low' { 5 }\n\t\t\t\t\t\t'normal' { 3 }\n\t\t\t\t\t\t'high' { 1 }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} | ConvertTo-Json -Depth 100\n\t\t}\n\t}\n\n\tif ($Attachments.Count -gt 0) {\n\t\t$counter = 0\n\t\tforeach ($attachment in $Attachments) {\n\t\t\t$counter++\n\t\t\t$requestSplat.Form[\"file$($counter)\"] = (Get-Item -Path $attachment)\n\t\t}\n\t}\n\n\ttry {\n\t\t$null = Invoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"Email Sent\"\n\t}\n\tcatch {\n\t\tthrow \"There was an issue sending the email.\"\n\t\t$_\n\t}\n}\n\n# MARK: Begin\n\n# Read job parameters from JSON input\n[PSCustomObject]$Script:xyOps = ConvertFrom-Json -Depth 100 (Read-Host)\n\ntry {\n\t$command = [scriptblock]::create($Script:xyOps.params.command)\n}\ncatch {\n\tthrow \"The code block provided is invalid. Please use a proper code editor to verify your script.\"\n}\n\n$Script:enableLogTime = $Script:xyOps.params.logtime\n\nif ($Script:xyOps.input -and ($Script:xyOps.params.passdata -eq $true)) {\n\tif ($Script:xyOps.input.data) {\n\t\tSend-xyOpsData $Script:xyOps.input.data\n\t}\n\telse {\n\t\tSend-xyOpsData $Script:xyOps.input\n\t}\n}\n\n# Set current directory to the working directory of the job\nSet-Location $Script:xyOps.cwd\n\n# Output xyOps Json data\nif ($Script:xyOps.params.outputxyops) {\n\t$formattedJson = $Script:xyOps | ConvertTo-Json -Depth 100\n\t$markdownContent = \"``````json`n$($formattedJson)`n``````\"\n\tSend-xyOpsMarkdown -Content $markdownContent -Title \"Job Data - Json\"\n}\n\n# Output PowerShell Version\nWrite-xyOpsJobOutput \"PowerShell Version: $($PSVersionTable.PSVersion)\"\n\n# Import any .psm1 module files provided from a bucket fetch action.\nif ($Script:xyOps.params.processmodules) {\n\t$moduleFiles = Get-xyOpsInputFiles | Where-Object { $_.filename -like \"*.psm1\" }\n\tforeach ($moduleFile in $moduleFiles) {\n\t\ttry {\n\t\t\tWrite-xyOpsJobOutput \"Loading module file: $($moduleFile.filename)\" -Level info\n\t\t\tImport-Module \"./$($moduleFile.filename)\"\n\t\t}\n\t\tcatch {\n\t\t\tWrite-xyOpsJobOutput $_ -Level error\n\t\t}\n\t}\n}\n\nWrite-xyOpsJobOutput 'Job Started'\n\ntry {\n\n\t& $command\n\n\t# Report success\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\tcode = 0\n\t\t})\n}\ncatch {\n\t# Write out error details\n\tWrite-xyOpsJobOutput \"Error:\" -Level error\n\tWrite-xyOpsJobOutput $_ -Level error\n\tWrite-xyOpsJobOutput \"Exception:\" -Level error\n\tWrite-xyOpsJobOutput $_.Exception -Level error\n\n\t# Report failure\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy          = 1\n\t\t\tcode        = 999\n\t\t\tdescription = \"Job failed!\"\n\t\t})\n}\nfinally {\n\tWrite-xyOpsJobOutput 'Job Finished'\n}",
				"groups": [],
				"format": "",
				"params": [
					{
						"id": "command",
						"title": "Code Block",
						"type": "code",
						"caption": "A code block that contains the PowerShell script code to be executed.",
						"locked": false,
						"value": "# PowerShell script code goes here\n",
						"required": true
					},
					{
						"id": "logtime",
						"title": "Enable Time in Output",
						"type": "checkbox",
						"caption": "Enables a timestamp on each output line when using the Log helper function",
						"locked": false,
						"value": true
					},
					{
						"id": "outputxyops",
						"title": "Output xyOps JSON Data",
						"type": "checkbox",
						"caption": "Output the job JSON data as markdown formatted in the job output. USE WITH CAUTION as this will contain any included secret variables in clear-text.",
						"locked": true,
						"value": false
					},
					{
						"id": "processmodules",
						"title": "Process Module Files",
						"type": "checkbox",
						"caption": "Import all .psm1 files attached to the job input. These files can be manually uploaded each time or added to a bucket to be referenced by a 'Fetch Bucket' action.",
						"locked": false,
						"value": true
					},
					{
						"id": "passdata",
						"title": "Data Passthrough",
						"type": "checkbox",
						"caption": "If checked, data output from one event will pass through automatically to its output. Note that if an event outputs the same data property as existing data that was passed in, it will overwrite what was passed into it.",
						"locked": false,
						"value": false
					},
					{
						"id": "bucketapikeyvariable",
						"title": "Bucket API Key Variable Name",
						"type": "text",
						"caption": "The secret vault variable name used for the API Key for accessing buckets. See 'Setting Up Cache Bucket' section of the plugin readme.",
						"locked": true,
						"value": "XYOPS_BUCKET_API_KEY",
						"variant": "text",
						"required": false
					},
					{
						"id": "cachebucketidvariable",
						"title": "Cache Bucket ID Variable Name",
						"type": "text",
						"caption": "The secret vault variable name used for the Bucket ID when configuring the cache bucket setup. See 'Setting Up Cache Bucket' section of the plugin readme.",
						"locked": true,
						"value": "XYOPS_CACHE_BUCKET_ID",
						"variant": "text",
						"required": false
					},
					{
						"id": "sendemailapikeyvariable",
						"title": "Send Email API Key Variable Name",
						"type": "text",
						"caption": "The secret vault variable name used for the API Key for sending emails. See 'Setting Up Email API Key' section of the plugin readme.",
						"locked": true,
						"value": "XYOPS_SENDEMAIL_API_KEY",
						"variant": "text",
						"required": false
					}
				],
				"kill": "parent",
				"runner": false,
				"notes": "",
				"icon": "powershell",
				"uid": "",
				"gid": ""
			}
		}
	]
}