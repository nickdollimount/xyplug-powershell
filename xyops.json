{
	"type": "xypdf",
	"description": "xyOps Portable Data Object",
	"version": "1.0",
	"items": [
		{
			"type": "plugin",
			"data": {
				"id": "pmkiue8906n0zvg0",
				"title": "PowerShell",
				"enabled": true,
				"type": "event",
				"command": "pwsh",
				"script": "<#\n.SYNOPSIS\n    xyOps PowerShell event plugin - Executes PowerShell commands within the xyOps environment.\n\n.DESCRIPTION\n    This script is a xyOps event plugin that executes PowerShell code blocks and reports progress,\n    output, and file changes back to the xyOps system. It provides structured logging with\n    optional timestamps and handles job execution with comprehensive error handling.\n    \n    The script reads job parameters from JSON input, executes the provided PowerShell command,\n    and reports results in a standardized format that xyOps can process.\n\n.PARAMETER None\n    This script reads parameters from JSON input via Read-Host.\n\n.NOTES\n    Author:         Nick Dollimount\n    Contributor:    Tim Alderweireldt\n    Copyright:      2026\n    Purpose:        xyOps PowerShell event plugin\n    Features:       - Cross-platform compatibility\n                    - Comprehensive helper functions for xyOps integration\n\n#>\n\n# MARK: Write-xyOpsJobOutput\nfunction Write-xyOpsJobOutput {\n    <#\n    .SYNOPSIS\n        Writes messages to the xyOps job output stream with optional timestamps.\n    \n    .DESCRIPTION\n        Logs messages to the xyOps job output with configurable timestamp prefixes.\n        Uses the PowerShell Information stream for output.\n    \n    .PARAMETER Message\n        The message to log.\n    \n    .PARAMETER Level\n        The log level (info, warning, error). Default is 'info'.\n    \n    .EXAMPLE\n        Write-xyOpsJobOutput \"Job started successfully\"\n    \n    .EXAMPLE\n        Write-xyOpsJobOutput \"An error occurred\" -Level error\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, Position = 0, ValueFromPipeline = $true)][string]$Message,\n        [Parameter(Mandatory = $false)][ValidateSet('info', 'warning', 'error')][string]$Level = 'info'\n    )\n\n    if ($Script:enableLogTime -eq $true) {\n        $timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss:ffff\"\n        $logMessage = \"[$($timestamp)] [$($Level)] $($Message)\"\n    }\n    else {\n        $logMessage = \"[$($Level)] $($Message)\"\n    }\n\n    Send-xyOpsOutput $logMessage\n}\n\n# MARK: Send-xyOpsOutput\nfunction Send-xyOpsOutput {\n    <#\n    .SYNOPSIS\n        Sends structured JSON output back to the xyOps system. This is low-level output to xyOps.\n    \n    .DESCRIPTION\n        Converts PowerShell objects to JSON format and writes them to the output stream\n        for consumption by the xyOps system. Supports hashtables, PSCustomObjects, arrays,\n        and primitive types. Automatically flushes output to prevent buffering.\n    \n    .PARAMETER InputObject\n        The object to send to xyOps. Can be a hashtable, PSCustomObject, array, or primitive type.\n    \n    .EXAMPLE\n        Send-xyOpsOutput @{ xy = 1; code = 0 }\n    \n    .EXAMPLE\n        Send-xyOpsOutput ([pscustomobject]@{ xy = 1; progress = 50 })\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true)][object]$InputObject\n    )\n\n    try {\n        Write-Information -MessageData (($InputObject -is [string]) ? $InputObject : ($InputObject | ConvertTo-Json -Depth 100 -Compress)) -InformationAction Continue -OutBuffer 0\n    }\n    catch {\n        Throw \"Unsupported data type.\"\n    }\n}\n\n# MARK: Send-xyOpsProgress\nfunction Send-xyOpsProgress {\n    <#\n    .SYNOPSIS\n        Reports job progress percentage to xyOps.\n    \n    .DESCRIPTION\n        Sends a progress update to the xyOps system with a percentage value between 0 and 100.\n        Optionally, you can include a status with the progress update using the -Status parameter.\n    \n    .PARAMETER Percent\n        The progress percentage (0-100).\n    \n    .PARAMETER Status\n        The current status for the job.\n    \n    .EXAMPLE\n        Send-xyOpsProgress -Percent 25\n    \n    .EXAMPLE\n        Send-xyOpsProgress -Percent 46 -Status \"Processing $($itemNumber) of $($items.Count)...\"\n    \n    .EXAMPLE\n        Send-xyOpsProgress 75.5 \"Almost done!\"\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][decimal]$Percent,\n        [Parameter(Mandatory = $false, ValueFromPipeline = $true, Position = 1)][string]$Status\n    )\n\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy       = 1\n            progress = $Percent / 100\n            status   = $Status\n        })\n}\n\n# MARK: Send-xyOpsStatus\nfunction Send-xyOpsStatus {\n    <#\n    .SYNOPSIS\n        Reports job status to xyOps.\n    \n    .DESCRIPTION\n        Sends a status for the job that is displayed on the job status page as well as the jobs list.\n    \n    .PARAMETER Status\n        The current status for the job.\n    \n    .EXAMPLE\n        Send-xyOpsStatus \"Building sites list...\"\n    \n    .EXAMPLE\n        Send-xyOpsStatus -Status \"Processing $($itemNumber) of $($items.Count)...\"\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$Status\n    )\n\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy       = 1\n            status   = $Status\n        })\n}\n\n# MARK: New-Filename\nfunction New-Filename {\n    <#\n    .SYNOPSIS\n        Generates a unique filename.\n    \n    .DESCRIPTION\n        Generates a unique filename using a new Guid value to avoid reusing filenames.\n    \n    .PARAMETER Filetype\n        The file type that should be used in the filename generation.\n\n    .PARAMETER Prefix\n        Optional string to add to the beginning of the filename. Spaces are automatically converted to underscores.\n    \n    .EXAMPLE\n        New-Filename -Filetype csv\n    \n    .EXAMPLE\n        New-Filename -Filetype log -Prefix \"data update\"\n    \n    .EXAMPLE\n        New-Filename log\n    #>\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true)]$Filetype,\n        [Parameter(Mandatory = $false)]$Prefix\n    )\n\n    $prefix = $Prefix -replace \" \", \"_\"\n    $guid = (New-Guid).Guid\n\n    $filename = \"$((![string]::IsNullOrEmpty($prefix)) ? \"$($prefix)_\" : $null)$($guid).$($fileType)\"\n    return $filename\n}\n\n# MARK: Send-xyOpsFile\nfunction Send-xyOpsFile {\n    <#\n    .SYNOPSIS\n        Reports file changes to the xyOps system so that xyOps can upload the file and use it.\n    \n    .DESCRIPTION\n        Notifies xyOps about files that have been created, modified, or should be tracked\n        during job execution.\n    \n    .PARAMETER Filename\n        The path to the file to report.\n    \n    .EXAMPLE\n        Send-xyOpsFile \"/path/to/output.txt\"\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Filename\n    )\n\n    $output = [pscustomobject]@{\n        xy    = 1\n        files = @(\n            @{\n                path   = $Filename\n                delete = $false\n            }\n        )\n    }\n\n    Send-xyOpsOutput $output\n}\n\n# MARK: Send-xyOpsPerf\nfunction Send-xyOpsPerf {\n    <#\n    .SYNOPSIS\n        Reports performance metrics to xyOps.\n    \n    .DESCRIPTION\n        Sends performance timing data to xyOps for display as a pie chart on the Job Details page.\n        Metrics represent time spent in different categories.\n    \n    .PARAMETER Metrics\n        Hashtable of performance metrics where keys are category names and values are time in seconds.\n    \n    .PARAMETER Scale\n        Optional scale factor if metrics are not in seconds (e.g., 1000 for milliseconds).\n    \n    .EXAMPLE\n        Send-xyOpsPerf @{ db = 18.51; http = 3.22; gzip = 0.84 }\n    \n    .EXAMPLE\n        Send-xyOpsPerf @{ db = 1851; http = 3220; gzip = 840 } -Scale 1000\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true)][hashtable]$Metrics,        \n        [Parameter(Mandatory = $false)][int]$Scale\n    )\n\n    $output = [pscustomobject]@{\n        xy   = 1\n        perf = $Metrics\n    }\n    \n    if ($Scale) {\n        $output.perf['scale'] = $Scale\n    }\n\n    Send-xyOpsOutput $output\n}\n\n# MARK: Send-xyOpsLabel\nfunction Send-xyOpsLabel {\n    <#\n    .SYNOPSIS\n        Sets a custom label for the job.\n    \n    .DESCRIPTION\n        Adds a custom label to the job which will be displayed alongside the Job ID\n        in the xyOps UI. Useful for differentiating jobs with different parameters.\n    \n    .PARAMETER Label\n        The label text to display.\n    \n    .EXAMPLE\n        Send-xyOpsLabel \"Reindex Database\"\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Label\n    )\n\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy    = 1\n            label = $Label\n        })\n}\n\n# MARK: Send-xyOpsData\nfunction Send-xyOpsData {\n    <#\n    .SYNOPSIS\n        Sends arbitrary output data to be passed to the next job.\n    \n    .DESCRIPTION\n        Outputs data that will be automatically passed to the next job in a workflow\n        or via a run event action. Data can be any PowerShell object.\n    \n    .PARAMETER Data\n        The data object to pass to the next job.\n    \n    .EXAMPLE\n        Send-xyOpsData @{ hostname = \"server01\"; status = \"ok\" }\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true)][object]$Data\n    )\n\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy   = 1\n            data = $Data\n        })\n}\n\n# MARK: Send-xyOpsTable\nfunction Send-xyOpsTable {\n    <#\n    .SYNOPSIS\n        Sends tabular data for display in the xyOps UI.\n    \n    .DESCRIPTION\n        Renders a data table on the Job Details page in xyOps.\n    \n    .PARAMETER Rows\n        Array of rows, where each row is an array of column values.\n    \n    .PARAMETER Title\n        Optional title displayed above the table.\n    \n    .PARAMETER Header\n        Optional array of header column names.\n    \n    .PARAMETER Caption\n        Optional caption displayed under the table.\n    \n    .EXAMPLE\n        Send-xyOpsTable -Rows @(@(\"192.168.1.1\", \"Server1\", 100), @(\"192.168.1.2\", \"Server2\", 200)) -Header @(\"IP\", \"Name\", \"Count\")\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true)][array]$Rows,\n        [Parameter(Mandatory = $false)][string]$Title,\n        [Parameter(Mandatory = $false)][array]$Header,\n        [Parameter(Mandatory = $false)][string]$Caption\n    )\n\n    $table = @{\n        rows = $Rows\n    }\n    \n    if ($Title) { $table['title'] = $Title }\n    if ($Header) { $table['header'] = $Header }\n    if ($Caption) { $table['caption'] = $Caption }\n\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy    = 1\n            table = $table\n        })\n}\n\n# MARK: Send-xyOpsHtml\nfunction Send-xyOpsHtml {\n    <#\n    .SYNOPSIS\n        Sends custom HTML content for display in xyOps.\n    \n    .DESCRIPTION\n        Renders custom HTML on the Job Details page. Only basic HTML elements are allowed.\n    \n    .PARAMETER Content\n        The HTML content to display.\n    \n    .PARAMETER Title\n        Optional title displayed above the content.\n    \n    .PARAMETER Caption\n        Optional caption displayed under the content.\n    \n    .EXAMPLE\n        Send-xyOpsHtml -Content \"<h3>Results</h3><p>Job completed <b>successfully</b></p>\" -Title \"Summary\"\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true)][string]$Content,\n        [Parameter(Mandatory = $false)][string]$Title,\n        [Parameter(Mandatory = $false)][string]$Caption\n    )\n\n    $html = @{\n        content = $Content\n    }\n    \n    if ($Title) { $html['title'] = $Title }\n    if ($Caption) { $html['caption'] = $Caption }\n\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy   = 1\n            html = $html\n        })\n}\n\n# MARK: Send-xyOpsText\nfunction Send-xyOpsText {\n    <#\n    .SYNOPSIS\n        Sends plain text content to display in xyOps in a separate textbox.\n    \n    .DESCRIPTION\n        Renders plain text on the Job Details page with formatting preserved.\n    \n    .PARAMETER Content\n        The plain text content to display.\n    \n    .PARAMETER Title\n        Optional title displayed above the content.\n    \n    .PARAMETER Caption\n        Optional caption displayed under the content.\n    \n    .EXAMPLE\n        Send-xyOpsText -Content \"Log file contents...\" -Title \"Log Output\"\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true)][string]$Content,\n        [Parameter(Mandatory = $false)][string]$Title,\n        [Parameter(Mandatory = $false)][string]$Caption\n    )\n\n    $text = @{\n        content = $Content\n    }\n    \n    if ($Title) { $text['title'] = $Title }\n    if ($Caption) { $text['caption'] = $Caption }\n\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy   = 1\n            text = $text\n        })\n}\n\n# MARK: Send-xyOpsMarkdown\nfunction Send-xyOpsMarkdown {\n    <#\n    .SYNOPSIS\n        Sends Markdown content for display in xyOps.\n    \n    .DESCRIPTION\n        Renders Markdown on the Job Details page (converted to HTML).\n    \n    .PARAMETER Content\n        The Markdown content to display.\n    \n    .PARAMETER Title\n        Optional title displayed above the content.\n    \n    .PARAMETER Caption\n        Optional caption displayed under the content.\n    \n    .EXAMPLE\n        Send-xyOpsMarkdown -Content \"## Results`n- Item 1`n- Item 2\" -Title \"Summary\"\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true)][string]$Content,\n        [Parameter(Mandatory = $false)][string]$Title,\n        [Parameter(Mandatory = $false)][string]$Caption\n    )\n\n    $markdown = @{\n        content = $Content\n    }\n    \n    if ($Title) { $markdown['title'] = $Title }\n    if ($Caption) { $markdown['caption'] = $Caption }\n\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy       = 1\n            markdown = $markdown\n        })\n}\n\n# MARK: Get-xyOpsInputFiles\nfunction Get-xyOpsInputFiles {\n    <#\n    .SYNOPSIS\n        Gets the list of input files passed to the job.\n    \n    .DESCRIPTION\n        Returns an array of input file metadata objects from the xyOps job input.\n        Files are already downloaded to the current working directory.\n    \n    .EXAMPLE\n        $files = Get-xyOpsInputFiles\n        foreach ($file in $files) {\n            Write-Host \"Processing: $($file.filename)\"\n        }\n    #>\n    $files = [System.Collections.Generic.List[object]]::new()\n\n    foreach ($file in $Script:xyOps.input.files) {\n        $files.Add($file)\n    }\n    \n    return $files\n}\n\n# MARK: Get-xyOpsBucketFile\nfunction Get-xyOpsBucketFile {\n    <#\n    .SYNOPSIS\n        Gets file from the specified bucket.\n    \n    .DESCRIPTION\n        Uses the get_bucket API to retrieve a file from a specified bucket.\n    \n    .EXAMPLE\n        Get-xyOpsBucketFile -BucketId 'bml2ut4ys4pt7raf' -Filename 'customers.csv'\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename,\n        [Parameter(Mandatory = $false, ValueFromPipeline = $true, Position = 2)][string]$OutFilename\n    )\n\n    if ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n        throw \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n    }\n\n    $bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n    $apiUri = \"$($Script:xyOps.base_url)/api/app/get_bucket/v1?id=$($BucketId)\"\n\n    $requestSplat = @{\n        Uri     = $apiUri\n        Method  = 'GET'\n        Headers = @{\n            'X-API-KEY' = $bucketApiKey\n        }\n    }\n\n    try {\n        $bucketData = (Invoke-RestMethod @requestSplat)\n    }\n    catch {\n        throw \"There was a problem retrieving the specified bucket details.\"\n        $_\n    }\n\n    if ([string]::IsNullOrEmpty($bucketData.files)) {\n        Write-xyOpsJobOutput \"There are no files in specified bucket.\"\n        return\n    }\n\n    $filePath = $bucketData.files.Where({ $_.filename -eq $Filename }).path\n\n    if ([string]::IsNullOrEmpty($filePath)) {\n        Write-xyOpsJobOutput \"The requested file does not exist in the specified bucket.\"\n        return\n    }\n\n    $apiUri = \"$($Script:xyOps.base_url)/$($filePath)\"\n\n    $requestSplat = @{\n        Uri     = $apiUri\n        Method  = 'GET'\n        Headers = @{\n            'X-API-KEY' = $bucketApiKey\n        }\n    }\n\n    try {\n        Invoke-RestMethod @requestSplat -OutFile \"./$(($OutFilename) ? $OutFilename : $Filename)\"\n    }\n    catch {\n        throw \"There was a problem downloading the requested file.\"\n        $_\n    }\n}\n\n# MARK: Add-xyOpsBucketFile\nfunction Add-xyOpsBucketFile {\n    <#\n    .SYNOPSIS\n        Adds file to the specified bucket.\n    \n    .DESCRIPTION\n        Uses the upload_bucket_files API to add a file to a specified bucket.\n    \n    .EXAMPLE\n        $newFile = New-FileName -FileType csv\n        $customers | Export-Csv -FilePath $newFile\n        Add-xyOpsBucketFile -BucketId 'bml2ut4ys4pt7raf' -Filename $newFile\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename\n    )\n\n    if ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n        throw \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n    }\n\n    $bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n    $apiUri = \"$($Script:xyOps.base_url)/api/app/upload_bucket_files/v1?id=$($BucketId)\"\n\n\n    $requestSplat = @{\n        Uri     = $apiUri\n        Method  = 'POST'\n        Headers = @{\n            'X-API-KEY' = $bucketApiKey\n        }\n        Form    = @{\n            file = (Get-Item -Path $Filename)\n        }\n    }\n\n    try {\n        Invoke-RestMethod @requestSplat\n        Write-xyOpsJobOutput \"File [$($Filename)] uploaded to Bucket [$($BucketId)].\"\n    }\n    catch {\n        throw \"There was a problem uploading the requested file.\"\n        $_\n    }\n}\n\n# MARK: Remove-xyOpsBucketFile\nfunction Remove-xyOpsBucketFile {\n    <#\n    .SYNOPSIS\n        Deletes file from the specified bucket.\n    \n    .DESCRIPTION\n        Uses the delete_bucket_file API to delete a file from a specified bucket.\n    \n    .EXAMPLE\n        Remove-xyOpsBucketFile -BucketId 'bml2ut4ys4pt7raf' -Filename 'customers.csv'\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename\n    )\n    \n    if ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n        throw \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n    }\n\n    $bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n    $apiUri = \"$($Script:xyOps.base_url)/api/app/delete_bucket_file/v1\"\n\n\n    $requestSplat = @{\n        Uri     = $apiUri\n        Method  = 'POST'\n        Headers = @{\n            'X-API-KEY' = $bucketApiKey\n        }\n        Body    = @{\n            id       = $BucketId\n            filename = $Filename\n        }\n    }\n\n    try {\n        $null = Invoke-RestMethod @requestSplat\n        Write-xyOpsJobOutput \"File [$($Filename)] was deleted from Bucket [$($BucketId)].\"\n    }\n    catch {\n        throw ($_.ErrorDetails.Message | ConvertFrom-Json)\n    }\n}\n\n# MARK: Get-xyOpsBucketData\nfunction Get-xyOpsBucketData {\n    <#\n    .SYNOPSIS\n        Gets data from the specified bucket.\n    \n    .DESCRIPTION\n        Uses the get_bucket API to retrieve JSON data from the specified bucket.\n    \n    .EXAMPLE\n        $bucketData = Get-xyOpsBucketData -BucketId 'bml2ut4ys4pt7raf'\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId\n    )\n\n    if ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n        throw \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n    }\n\n    $bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n    $apiUri = \"$($Script:xyOps.base_url)/api/app/get_bucket/v1?id=$($BucketId)\"\n\n    $requestSplat = @{\n        Uri     = $apiUri\n        Method  = 'GET'\n        Headers = @{\n            'X-API-KEY' = $bucketApiKey\n        }\n    }\n\n    try {\n        $bucketData = (Invoke-RestMethod @requestSplat).data\n    }\n    catch {\n        $_\n    }\n\n    return $bucketData\n}\n\n# MARK: Set-xyOpsBucketData\nfunction Set-xyOpsBucketData {\n    <#\n    .SYNOPSIS\n        Sets data in the cache bucket.\n    \n    .DESCRIPTION\n        Uses the write_bucket API to write a JSON converted object to a specified bucket data.\n    \n    .EXAMPLE\n        Set-xyOpsBucketData -BucketId 'bml2ut4ys4pt7raf' -Key 'Countries' -InputObject @('Canada','United States','United Kingdom')\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Key,\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 2)][object]$InputObject\n    )\n\n    if ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n        throw \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n    }\n\n    $bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n    $apiUri = \"$($Script:xyOps.base_url)/api/app/write_bucket_data/v1?id=$($BucketId)\"\n\n    $requestSplat = @{\n        Uri         = $apiUri\n        Method      = 'POST'\n        Headers     = @{\n            'X-API-KEY' = $bucketApiKey\n        }\n        ContentType = 'application/json'\n        Body        = @{\n            data = [PSCustomObject]@{\n                \"$($Key)\" = $InputObject\n            }\n        } | ConvertTo-Json -Depth 100\n    }\n\n    try {\n        $null = Invoke-RestMethod @requestSplat\n        Write-xyOpsJobOutput \"Bucket [$($BucketId)] data updated.\"\n    }\n    catch {\n        throw \"There was an issue updating bucket [$($BucketId)] data.\"\n        $_\n    }\n}\n\n# MARK: Get-xyOpsCache\nfunction Get-xyOpsCache {\n    <#\n    .SYNOPSIS\n        Gets data from the cache bucket.\n    \n    .DESCRIPTION\n        Uses the get_bucket API to retrieve JSON data from a bucket configured for cache.\n    \n    .EXAMPLE\n        $Countries = Get-xyOpsCache -Key Countries\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Key\n    )\n    if ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n        throw \"No secrets have been assigned to this plugin or event. Cache is currently unavailable.\"\n    }\n\n    $cacheBucketId = $Script:xyOps.secrets.\"$($Script:xyOps.params.cachebucketidvariable)\"\n\n    try {\n        $bucketData = Get-xyOpsBucketData -BucketId $cacheBucketId\n        $cacheData = $bucketData.\"$($Key)\"\n    }\n    catch {\n        $_\n    }\n\n    return $cacheData\n}\n\n# MARK: Set-xyOpsCache\nfunction Set-xyOpsCache {\n    <#\n    .SYNOPSIS\n        Sets data in the cache bucket.\n    \n    .DESCRIPTION\n        Uses the write_bucket API to write a JSON converted object to a bucket data configured for cache.\n    \n    .EXAMPLE\n        Set-xyOpsCache -Key Countries -InputObject @('Canada','United States','United Kingdom')\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$Key,\n        [Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][object]$InputObject\n    )\n\n    if ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n        throw \"No secrets have been assigned to this plugin or event. Cache is currently unavailable.\"\n    }\n\n    $cacheApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n    $cacheBucketId = $Script:xyOps.secrets.\"$($Script:xyOps.params.cachebucketidvariable)\"\n    $apiUri = \"$($Script:xyOps.base_url)/api/app/write_bucket_data/v1?id=$($cacheBucketId)\"\n\n    $requestSplat = @{\n        Uri         = $apiUri\n        Method      = 'POST'\n        Headers     = @{\n            'X-API-KEY' = $cacheApiKey\n        }\n        ContentType = 'application/json'\n        Body        = @{\n            data = [PSCustomObject]@{\n                \"$($Key)\" = $InputObject\n            }\n        } | ConvertTo-Json -Depth 100\n    }\n\n    try {\n        $null = Invoke-RestMethod @requestSplat\n        Write-xyOpsJobOutput \"Cache [$($Key)] updated.\"\n    }\n    catch {\n        throw \"There was an issue updating cache [$($Key)].\"\n        $_\n    }\n}\n\n# MARK: Get-xyOpsParam\nfunction Get-xyOpsParam {\n    <#\n    .SYNOPSIS\n        Gets a parameter value from xyOps or environment variable.\n    \n    .DESCRIPTION\n        Retrieves a parameter value, checking both the params object and environment variables.\n        Environment variables are checked first as xyOps passes params as env vars.\n        When called without a Name parameter, displays all available parameters in a formatted table.\n    \n    .PARAMETER Name\n        The parameter name to retrieve. If omitted, displays all available parameters.\n    \n    .PARAMETER Default\n        Optional default value if parameter is not found.\n    \n    .EXAMPLE\n        $timeout = Get-xyOpsParam -Name \"timeout\" -Default 30\n    \n    .EXAMPLE\n        Get-xyOpsParam\n        # Displays all available parameters from environment and xyOps\n    #>\n    [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $false)]\n        [string]$Name\n    )\n\n    # If no name specified, display all parameters\n    if ([string]::IsNullOrEmpty($Name)) {\n        $paramList = [System.Collections.Generic.List[object]]::new()\n        \n        # Collect environment variables\n        $envVars = [Environment]::GetEnvironmentVariables()\n        foreach ($key in $envVars.Keys) {\n            [void]$paramList.Add([PSCustomObject]@{\n                    Source = \"Environment\"\n                    Name   = $key\n                    Value  = $envVars[$key]\n                })\n        }\n        \n        # Collect xyOps params\n        if ($Script:xyOps.params) {\n            $Script:xyOps.params.PSObject.Properties | ForEach-Object {\n                [void]$paramList.Add([PSCustomObject]@{\n                        Source = \"xyOps\"\n                        Name   = $_.Name\n                        Value  = $_.Value\n                    })\n            }\n        }\n        \n        # Display as formatted table\n        return $paramList | Format-Table -Property Source, Name, Value -AutoSize\n    }\n\n    # Check environment variable first (xyOps passes params as env vars)\n    $envValue = [Environment]::GetEnvironmentVariable($Name)\n    if ($null -ne $envValue) {\n        return $envValue\n    }\n    \n    # Check params object\n    if ($Script:xyOps.params.$Name) {\n        return $Script:xyOps.params.$Name\n    }\n    \n    return $null\n}\n\n# MARK: Begin\n\n# Read job parameters from JSON input\n[PSCustomObject]$Script:xyOps = ConvertFrom-Json -Depth 100 (Read-Host)\n\ntry {\n    $command = [scriptblock]::create($Script:xyOps.params.command)\n}\ncatch {\n    throw \"The code block provided is invalid. Please use a proper code editor to verify your script.\"\n}\n\n$Script:enableLogTime = $Script:xyOps.params.logtime\n\nif ($Script:xyOps.input -and ($Script:xyOps.params.passdata -eq $true)) {\n    if ($Script:xyOps.input.data) {\n        Send-xyOpsData $Script:xyOps.input.data\n    }\n    else {\n        Send-xyOpsData $Script:xyOps.input\n    }\n}\n\n# Set current directory to the working directory of the job\nSet-Location $Script:xyOps.cwd\n\n# Output xyOps Json data\nif ($Script:xyOps.params.outputxyops) {\n    $formattedJson = $Script:xyOps | ConvertTo-Json -Depth 100\n    $markdownContent = \"``````json`n$($formattedJson)`n``````\"\n    Send-xyOpsMarkdown -Content $markdownContent -Title \"Job Data - Json\"\n}\n\n# Output PowerShell Version\nWrite-xyOpsJobOutput \"PowerShell Version: $($PSVersionTable.PSVersion)\"\n\n# Import any .psm1 module files provided from a bucket fetch action.\nif ($Script:xyOps.params.processmodules) {\n    $moduleFiles = Get-xyOpsInputFiles | Where-Object { $_.filename -like \"*.psm1\" }\n    foreach ($moduleFile in $moduleFiles) {\n        try {\n            Write-xyOpsJobOutput \"Loading module file: $($moduleFile.filename)\" -Level info\n            Import-Module \"./$($moduleFile.filename)\"\n        }\n        catch {\n            Write-xyOpsJobOutput $_ -Level error\n        }\n    }\n}\n\nWrite-xyOpsJobOutput 'Job Started'\n\ntry {\n\n    & $command\n\n    # Report success\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy   = 1\n            code = 0\n        })\n}\ncatch {\n    # Write out error details\n    Write-xyOpsJobOutput \"Error:\" -Level error\n    Write-xyOpsJobOutput $_ -Level error\n    Write-xyOpsJobOutput \"Exception:\" -Level error\n    Write-xyOpsJobOutput $_.Exception -Level error\n\n    # Report failure\n    Send-xyOpsOutput ([pscustomobject]@{\n            xy          = 1\n            code        = 999\n            description = \"Job failed!\"\n        })\n}\nfinally {\n    Write-xyOpsJobOutput 'Job Finished'\n}",
				"groups": [],
				"format": "",
				"params": [
					{
						"id": "command",
						"title": "Code Block",
						"type": "code",
						"caption": "A code block that contains the PowerShell script code to be executed.",
						"locked": false,
						"value": "# PowerShell script code goes here\n",
						"required": true
					},
					{
						"id": "logtime",
						"title": "Enable Time in Output",
						"type": "checkbox",
						"caption": "Enables a timestamp on each output line when using the Log helper function",
						"locked": false,
						"value": true
					},
					{
						"id": "outputxyops",
						"title": "Output xyOps JSON Data",
						"type": "checkbox",
						"caption": "Output the job JSON data as markdown formatted in the job output. USE WITH CAUTION as this will contain any included secret variables in clear-text.",
						"locked": true,
						"value": false
					},
					{
						"id": "processmodules",
						"title": "Process Module Files",
						"type": "checkbox",
						"caption": "Import all .psm1 files attached to the job input. These files can be manually uploaded each time or added to a bucket to be referenced by a 'Fetch Bucket' action.",
						"locked": false,
						"value": true
					},
					{
						"id": "passdata",
						"title": "Data Passthrough",
						"type": "checkbox",
						"caption": "If checked, data output from one event will pass through automatically to its output. Note that if an event outputs the same data property as existing data that was passed in, it will overwrite what was passed into it.",
						"locked": false,
						"value": false
					},
					{
						"id": "bucketapikeyvariable",
						"title": "Bucket API Key Variable Name",
						"type": "text",
						"caption": "The secret vault variable name used for the API Key for accessing buckets. See 'Setting Up Cache Bucket' section of the plugin readme.",
						"locked": true,
						"value": "XYOPS_BUCKET_API_KEY",
						"variant": "text",
						"required": false
					},
					{
						"id": "cachebucketidvariable",
						"title": "Cache Bucket ID Variable Name",
						"type": "text",
						"caption": "The secret vault variable name used for the Bucket ID when configuring the cache bucket setup. See 'Setting Up Cache Bucket' section of the plugin readme.",
						"locked": true,
						"value": "XYOPS_CACHE_BUCKET_ID",
						"variant": "text",
						"required": false
					}
				],
				"kill": "parent",
				"runner": false,
				"notes": "",
				"icon": "powershell",
				"uid": "",
				"gid": ""
			}
		}
	]
}