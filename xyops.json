{
	"type": "xypdf",
	"description": "xyOps Portable Data Object",
	"version": "1.0",
	"items": [
		{
			"type": "plugin",
			"data": {
				"id": "pmkiue8906n0zvg0",
				"title": "PowerShell",
				"enabled": true,
				"type": "event",
				"command": "pwsh",
				"script": "<#\n.SYNOPSIS\n\txyOps PowerShell event plugin - Executes PowerShell commands within the xyOps environment.\n\n.DESCRIPTION\n\tThis script is a xyOps event plugin that executes PowerShell code blocks and reports progress,\n\toutput, and file changes back to the xyOps system. It provides structured logging with\n\toptional timestamps and handles job execution with comprehensive error handling.\n\t\n\tThe script reads job parameters from JSON input, executes the provided PowerShell command,\n\tand reports results in a standardized format that xyOps can process.\n\n.PARAMETER None\n\tThis script reads parameters from JSON input via Read-Host.\n\n.NOTES\n\tAuthor:         Nick Dollimount\n\tContributor:    Tim Alderweireldt\n\tCopyright:      2026\n\tPurpose:        xyOps PowerShell event plugin\n\tFeatures:       - Cross-platform compatibility\n                    - Comprehensive helper functions for xyOps integration\n\n#>\n\n# MARK: Write-xyOpsJobOutput\nfunction Write-xyOpsJobOutput {\n\t<#\n\t.SYNOPSIS\n\t\tWrites messages to the xyOps job output stream with optional timestamps.\n\t\n\t.DESCRIPTION\n\t\tLogs messages to the xyOps job output with configurable timestamp prefixes.\n\t\tUses the PowerShell Information stream for output.\n\t\n\t.PARAMETER Message\n\t\tThe message to log.\n\t\n\t.PARAMETER Level\n\t\tThe log level (info, warning, error). Default is 'info'.\n\t\n\t.EXAMPLE\n\t\tWrite-xyOpsJobOutput \"Sample output to be passed to xyOps job output.\"\n\t\n\t.EXAMPLE\n\t\t\"Log this information to the job output, please. Thanks.\" | Write-xyOpsJobOutput -Level warning\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, Position = 0, ValueFromPipeline = $true)][string]$Message,\n\t\t[Parameter(Mandatory = $false)][ValidateSet('info', 'warning', 'error')][string]$Level = 'info'\n\t)\n\n\tif ($Script:enableLogTime -eq $true) {\n\t\t$timestamp = Get-Date -Format \"yyyy-MM-dd HH:mm:ss:ffff\"\n\t\t$logMessage = \"[$($timestamp)] [$($Level)] $($Message)\"\n\t}\n\telse {\n\t\t$logMessage = \"[$($Level)] $($Message)\"\n\t}\n\n\tSend-xyOpsOutput $logMessage\n}\n\n# MARK: Send-xyOpsOutput\nfunction Send-xyOpsOutput {\n\t<#\n\t.SYNOPSIS\n\t\tSends structured JSON output back to the xyOps system. This is low-level output to xyOps.\n\t\n\t.DESCRIPTION\n\t\tConverts PowerShell objects to JSON format and writes them to the output stream\n\t\tfor consumption by the xyOps system. Supports hashtables, PSCustomObjects, arrays,\n\t\tand primitive types. Automatically flushes output to prevent buffering.\n\t\n\t.PARAMETER InputObject\n\t\tThe object to send to xyOps. Can be a hashtable, PSCustomObject, array, or primitive type.\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsOutput @{ xy = 1; code = 0 }\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy       = 1\n\t\t\tprogress = 0.75\n\t\t})\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][object]$InputObject\n\t)\n\n\ttry {\n\t\tWrite-Information -MessageData (($InputObject -is [string]) ? $InputObject : ($InputObject | ConvertTo-Json -Depth 100 -Compress)) -InformationAction Continue -OutBuffer 0\n\t}\n\tcatch {\n\t\tThrow \"Unsupported data type.\"\n\t}\n}\n\n# MARK: Send-xyOpsProgress\nfunction Send-xyOpsProgress {\n\t<#\n\t.SYNOPSIS\n\t\tReports job progress percentage to xyOps.\n\t\n\t.DESCRIPTION\n\t\tSends a progress update to the xyOps system with a percentage value between 0 and 100.\n\t\tOptionally, you can include a status with the progress update using the -Status parameter.\n\t\n\t.PARAMETER Percent\n\t\tThe progress percentage (0-100).\n\t\n\t.PARAMETER Status\n\t\tThe current status for the job.\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsProgress -Percent 25\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsProgress -Percent 46 -Status \"Processing $($itemNumber) of $($items.Count)...\"\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsProgress 75.5 \"Almost done!\"\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][decimal]$Percent,\n\t\t[Parameter(Mandatory = $false, ValueFromPipeline = $true, Position = 1)][string]$Status\n\t)\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy       = 1\n\t\t\tprogress = $Percent / 100\n\t\t\tstatus   = $Status\n\t\t})\n}\n\n# MARK: Send-xyOpsStatus\nfunction Send-xyOpsStatus {\n\t<#\n\t.SYNOPSIS\n\t\tReports job status to xyOps.\n\t\n\t.DESCRIPTION\n\t\tSends a status for the job that is displayed on the job status page as well as the jobs list.\n\t\n\t.PARAMETER Status\n\t\tThe current status for the job.\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsStatus \"Building sites list...\"\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsStatus -Status \"Processing $($itemNumber) of $($items.Count)...\"\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$Status\n\t)\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy     = 1\n\t\t\tstatus = $Status\n\t\t})\n}\n\n# MARK: New-Filename\nfunction New-Filename {\n\t<#\n\t.SYNOPSIS\n\t\tGenerates a unique filename.\n\t\n\t.DESCRIPTION\n\t\tGenerates a unique filename using a new Guid value to avoid reusing filenames.\n\t\n\t.PARAMETER Filetype\n\t\tThe file type that should be used in the filename generation.\n\n\t.PARAMETER Prefix\n\t\tOptional string to add to the beginning of the filename. Spaces are automatically converted to underscores.\n\t\n\t.EXAMPLE\n\t\tNew-Filename -Filetype csv\n\t\n\t.EXAMPLE\n\t\tNew-Filename -Filetype log -Prefix \"data update\"\n\t\n\t.EXAMPLE\n\t\tNew-Filename log\n\t#>\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)]$Filetype,\n\t\t[Parameter(Mandatory = $false)]$Prefix\n\t)\n\n\t$prefix = $Prefix -replace \" \", \"_\"\n\t$guid = (New-Guid).Guid\n\n\t$filename = \"$((![string]::IsNullOrEmpty($prefix)) ? \"$($prefix)_\" : $null)$($guid).$($fileType)\"\n\treturn $filename\n}\n\n# MARK: Send-xyOpsFile\nfunction Send-xyOpsFile {\n\t<#\n\t.SYNOPSIS\n\t\tReports file changes to the xyOps system so that xyOps can upload the file and use it.\n\t\n\t.DESCRIPTION\n\t\tUploads a file to the job output. The file is then accessible in the UI to download. It can also be passed to the input of a proceeding event within a workflow to be further processed.\n\t\n\t.PARAMETER Filename\n\t\tThe path to the file to report.\n\t\n\t.EXAMPLE\n\t\t$outfile = \"people_$(New-Guid).csv\"\n\t\t$peopleList | Export-Csv -Path $outfile\n\t\tSend-xyOpsFile $outfile\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Filename\n\t)\n\n\t$output = [pscustomobject]@{\n\t\txy    = 1\n\t\tfiles = @(\n\t\t\t@{\n\t\t\t\tpath   = $Filename\n\t\t\t\tdelete = $false\n\t\t\t}\n\t\t)\n\t}\n\n\tSend-xyOpsOutput $output\n}\n\n# MARK: Send-xyOpsPerf\nfunction Send-xyOpsPerf {\n\t<#\n\t.SYNOPSIS\n\t\tReports performance metrics to xyOps.\n\t\n\t.DESCRIPTION\n\t\tSends performance timing data to xyOps for display as a pie chart on the Job Details page. Metrics represent time spent in different categories.\n\t\n\t.PARAMETER Metrics\n\t\tHashtable of performance metrics where keys are category names and values are time in seconds.\n\t\n\t.PARAMETER Scale\n\t\tOptional scale factor if metrics are not in seconds (e.g., 1000 for milliseconds).\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsPerf @{ db = 18.51; http = 3.22; gzip = 0.84 }\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsPerf @{ db = 1851; http = 3220; gzip = 840 } -Scale 1000\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][hashtable]$Metrics,\n\t\t[Parameter(Mandatory = $false)][int]$Scale\n\t)\n\n\t$output = [pscustomobject]@{\n\t\txy   = 1\n\t\tperf = $Metrics\n\t}\n\t\n\tif ($Scale) {\n\t\t$output.perf['scale'] = $Scale\n\t}\n\n\tSend-xyOpsOutput $output\n}\n\n# MARK: Send-xyOpsLabel\nfunction Send-xyOpsLabel {\n\t<#\n\t.SYNOPSIS\n\t\tSets a custom label for the job.\n\t\n\t.DESCRIPTION\n\t\tAdds a custom label to the job which will be displayed alongside the Job ID\n\t\tin the xyOps UI. Useful for differentiating jobs with different parameters.\n\t\n\t.PARAMETER Label\n\t\tThe label text to display.\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsLabel \"Backup - Production DB\"\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsLabel \"Deploy to $env:TARGET_ENV\"\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Label\n\t)\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy    = 1\n\t\t\tlabel = $Label\n\t\t})\n}\n\n# MARK: Send-xyOpsData\nfunction Send-xyOpsData {\n\t<#\n\t.SYNOPSIS\n\t\tSends arbitrary output data to be passed to the next job.\n\t\n\t.DESCRIPTION\n\t\tOutputs data that will be automatically passed to the next job in a workflow or via a run event action. Data can be any PowerShell object.\n\t\n\t.PARAMETER Data\n\t\tThe data object to pass to the next job.\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsData @{ hostname = \"server01\"; status = \"ok\" }\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][object]$Data\n\t)\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\tdata = $Data\n\t\t})\n}\n\n# MARK: Send-xyOpsTable\nfunction Send-xyOpsTable {\n\t<#\n\t.SYNOPSIS\n\t\tSends tabular data for display in the xyOps UI.\n\t\n\t.DESCRIPTION\n\t\tRenders a data table on the Job Details page in xyOps.\n\t\n\t.PARAMETER Rows\n\t\tArray of rows, where each row is an array of column values.\n\t\n\t.PARAMETER Title\n\t\tOptional title displayed above the table.\n\t\n\t.PARAMETER Header\n\t\tOptional array of header column names.\n\t\n\t.PARAMETER Caption\n\t\tOptional caption displayed under the table.\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsTable -Rows @(@(\"192.168.1.1\", \"Server1\", 100), @(\"192.168.1.2\", \"Server2\", 200)) -Header @(\"IP\", \"Name\", \"Count\")\n\t\n\t.EXAMPLE\n\t\t$rows = @(\n\t\t\t@(\"192.168.1.1\", \"Server1\", \"Online\"),\n\t\t\t@(\"192.168.1.2\", \"Server2\", \"Offline\")\n\t\t)\n\t\tSend-xyOpsTable -Rows $rows -Header @(\"IP\", \"Name\", \"Status\") -Title \"Server Status\"\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][array]$Rows,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][array]$Header,\n\t\t[Parameter(Mandatory = $false)][string]$Caption\n\t)\n\n\t$table = @{\n\t\trows = $Rows\n\t}\n\t\n\tif ($Title) { $table['title'] = $Title }\n\tif ($Header) { $table['header'] = $Header }\n\tif ($Caption) { $table['caption'] = $Caption }\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy    = 1\n\t\t\ttable = $table\n\t\t})\n}\n\n# MARK: Send-xyOpsHtml\nfunction Send-xyOpsHtml {\n\t<#\n\t.SYNOPSIS\n\t\tSends custom HTML content for display in xyOps.\n\t\n\t.DESCRIPTION\n\t\tRenders custom HTML on the Job Details page. Only basic HTML elements are allowed.\n\t\n\t.PARAMETER Content\n\t\tThe HTML content to display.\n\t\n\t.PARAMETER Title\n\t\tOptional title displayed above the content.\n\t\n\t.PARAMETER Caption\n\t\tOptional caption displayed under the content.\n\t\n\t.EXAMPLE\n\t\t$html = \"<h3>Summary</h3><ul><li>Total: <b>1000</b></li></ul>\"\n\t\tSend-xyOpsHtml -Content $html -Title \"Results\"\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][string]$Content,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][string]$Caption\n\t)\n\n\t$html = @{\n\t\tcontent = $Content\n\t}\n\t\n\tif ($Title) { $html['title'] = $Title }\n\tif ($Caption) { $html['caption'] = $Caption }\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\thtml = $html\n\t\t})\n}\n\n# MARK: Send-xyOpsText\nfunction Send-xyOpsText {\n\t<#\n\t.SYNOPSIS\n\t\tSends plain text content to display in xyOps in a separate textbox.\n\t\n\t.DESCRIPTION\n\t\tRenders plain text on the Job Details page with formatting preserved.\n\t\n\t.PARAMETER Content\n\t\tThe plain text content to display.\n\t\n\t.PARAMETER Title\n\t\tOptional title displayed above the content.\n\t\n\t.PARAMETER Caption\n\t\tOptional caption displayed under the content.\n\t\n\t.EXAMPLE\n\t\t$logContent = Get-Content \"/var/log/app.log\" -Raw\n\t\tSend-xyOpsText -Content $logContent -Title \"Application Log\"\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][string]$Content,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][string]$Caption\n\t)\n\n\t$text = @{\n\t\tcontent = $Content\n\t}\n\t\n\tif ($Title) { $text['title'] = $Title }\n\tif ($Caption) { $text['caption'] = $Caption }\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\ttext = $text\n\t\t})\n}\n\n# MARK: Send-xyOpsMarkdown\nfunction Send-xyOpsMarkdown {\n\t<#\n\t.SYNOPSIS\n\t\tSends Markdown content for display in xyOps.\n\t\n\t.DESCRIPTION\n\t\tRenders Markdown on the Job Details page (converted to HTML).\n\t\n\t.PARAMETER Content\n\t\tThe Markdown content to display.\n\t\n\t.PARAMETER Title\n\t\tOptional title displayed above the content.\n\t\n\t.PARAMETER Caption\n\t\tOptional caption displayed under the content.\n\t\n\t.EXAMPLE\n\t\t$md = \"## Results`n- **Success**: 98%`n- **Failed**: 2%\"\n\t\tSend-xyOpsMarkdown -Content $md -Title \"Summary\"\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][string]$Content,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][string]$Caption\n\t)\n\n\t$markdown = @{\n\t\tcontent = $Content\n\t}\n\t\n\tif ($Title) { $markdown['title'] = $Title }\n\tif ($Caption) { $markdown['caption'] = $Caption }\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy       = 1\n\t\t\tmarkdown = $markdown\n\t\t})\n}\n\n# MARK: Get-xyOpsInputFiles\nfunction Get-xyOpsInputFiles {\n\t<#\n\t.SYNOPSIS\n\t\tGets the list of input files passed to the job.\n\t\n\t.DESCRIPTION\n\t\tReturns an array of input file metadata objects from the xyOps job input. Files are already downloaded to the current working directory.\n\t\n\t.EXAMPLE\n\t\t$files = Get-xyOpsInputFiles\n\t\tforeach ($file in $files) {\n\t\t\tWrite-Host \"Processing: $($file.filename)\"\n\t\t}\n\t#>\n\t$files = [System.Collections.Generic.List[object]]::new()\n\n\tforeach ($file in $Script:xyOps.input.files) {\n\t\t$files.Add($file)\n\t}\n\t\n\treturn $files\n}\n\n# MARK: Get-xyOpsBucketFile\nfunction Get-xyOpsBucketFile {\n\t<#\n\t.SYNOPSIS\n\t\tGets file from the specified bucket.\n\t\n\t.DESCRIPTION\n\t\tUses the get_bucket API to retrieve a file from a specified bucket.\n\t\n\t.PARAMETER BucketId\n\t\tThe ID of the bucket you want to access.\n\n\t.PARAMETER Filename\n\t\tThe filename in the bucket you want to retrieve.\n\n\t.PARAMETER OutFilename\n\t\tOptionally, set the output filename to save as. Otherwise, the same filename as the original file is used.\n\n\t.EXAMPLE\n\t\tGet-xyOpsBucketFile -BucketId 'bml2ut4ys4pt7raf' -Filename 'customers.csv'\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename,\n\t\t[Parameter(Mandatory = $false, ValueFromPipeline = $true, Position = 2)][string]$OutFilename\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/get_bucket/v1?id=$($BucketId)\"\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'GET'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t}\n\n\ttry {\n\t\t$bucketData = (Invoke-RestMethod @requestSplat)\n\t}\n\tcatch {\n\t\tthrow \"There was a problem retrieving the specified bucket details.\"\n\t\t$_\n\t}\n\n\tif ([string]::IsNullOrEmpty($bucketData.files)) {\n\t\tWrite-xyOpsJobOutput \"There are no files in specified bucket.\"\n\t\treturn\n\t}\n\n\t$filePath = $bucketData.files.Where({ $_.filename -eq $Filename }).path\n\n\tif ([string]::IsNullOrEmpty($filePath)) {\n\t\tWrite-xyOpsJobOutput \"The requested file does not exist in the specified bucket.\"\n\t\treturn\n\t}\n\n\t$apiUri = \"$($Script:xyOps.base_url)/$($filePath)\"\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'GET'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t}\n\n\ttry {\n\t\tInvoke-RestMethod @requestSplat -OutFile \"./$(($OutFilename) ? $OutFilename : $Filename)\"\n\t}\n\tcatch {\n\t\tthrow \"There was a problem downloading the requested file.\"\n\t\t$_\n\t}\n}\n\n# MARK: Add-xyOpsBucketFile\nfunction Add-xyOpsBucketFile {\n\t<#\n\t.SYNOPSIS\n\t\tAdds file to the specified bucket.\n\t\n\t.DESCRIPTION\n\t\tUses the upload_bucket_files API to add a file to a specified bucket.\n\t\n\t.PARAMETER BucketId\n\t\tThe ID of the bucket you want to access.\n\t\n\t.PARAMETER Filename\n\t\tThe local filename you want to upload to the bucket.\n\n\t.EXAMPLE\n\t\t$newFile = New-FileName -FileType csv\n\t\t$customers | Export-Csv -FilePath $newFile\n\t\tAdd-xyOpsBucketFile -BucketId 'bml2ut4ys4pt7raf' -Filename $newFile\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/upload_bucket_files/v1?id=$($BucketId)\"\n\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'POST'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t\tForm    = @{\n\t\t\tfile = (Get-Item -Path $Filename)\n\t\t}\n\t}\n\n\ttry {\n\t\tInvoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"File [$($Filename)] uploaded to Bucket [$($BucketId)].\"\n\t}\n\tcatch {\n\t\tthrow \"There was a problem uploading the requested file.\"\n\t\t$_\n\t}\n}\n\n# MARK: Remove-xyOpsBucketFile\nfunction Remove-xyOpsBucketFile {\n\t<#\n\t.SYNOPSIS\n\t\tDeletes file from the specified bucket.\n\t\n\t.DESCRIPTION\n\t\tUses the delete_bucket_file API to delete a file from a specified bucket.\n\t\n\t.PARAMETER BucketId\n\t\tThe ID of the bucket you want to access.\n\t\n\t.PARAMETER Filename\n\t\tThe filename you want to delete from the bucket.\n\n\t.EXAMPLE\n\t\tRemove-xyOpsBucketFile -BucketId 'bml2ut4ys4pt7raf' -Filename 'customers.csv'\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Filename\n\t)\n\t\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/delete_bucket_file/v1\"\n\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'POST'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t\tBody    = @{\n\t\t\tid       = $BucketId\n\t\t\tfilename = $Filename\n\t\t}\n\t}\n\n\ttry {\n\t\t$null = Invoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"File [$($Filename)] was deleted from Bucket [$($BucketId)].\"\n\t}\n\tcatch {\n\t\tthrow ($_.ErrorDetails.Message | ConvertFrom-Json)\n\t}\n}\n\n# MARK: Get-xyOpsBucketData\nfunction Get-xyOpsBucketData {\n\t<#\n\t.SYNOPSIS\n\t\tGets data from the specified bucket.\n\t\n\t.DESCRIPTION\n\t\tUses the get_bucket API to retrieve JSON data from the specified bucket.\n\t\n\t.PARAMETER BucketId\n\t\tThe ID of the bucket you want to access.\n\n\t.EXAMPLE\n\t\t$bucketData = Get-xyOpsBucketData -BucketId 'bml2ut4ys4pt7raf'\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/get_bucket/v1?id=$($BucketId)\"\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'GET'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t}\n\n\ttry {\n\t\t$bucketData = (Invoke-RestMethod @requestSplat).data\n\t}\n\tcatch {\n\t\t$_\n\t}\n\n\treturn $bucketData\n}\n\n# MARK: Set-xyOpsBucketData\nfunction Set-xyOpsBucketData {\n\t<#\n\t.SYNOPSIS\n\t\tSets data in the cache bucket.\n\t\n\t.DESCRIPTION\n\t\tUses the write_bucket API to write a JSON converted object to a specified bucket data.\n\n\t.PARAMETER BucketId\n\t\tThe ID of the bucket you want to access.\n\t\n\t.PARAMETER Key\n\t\tThe key of the item you want to add to the bucket data.\n\n\t.PARAMETER InputObject\n\t\tThe input object you want to add to the bucket data.\n\t\n\t.EXAMPLE\n\t\tSet-xyOpsBucketData -BucketId 'bml2ut4ys4pt7raf' -Key 'Countries' -InputObject @('Canada','United States','United Kingdom')\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$BucketId,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][string]$Key,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 2)][object]$InputObject\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Bucket access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/write_bucket_data/v1?id=$($BucketId)\"\n\n\t$requestSplat = @{\n\t\tUri         = $apiUri\n\t\tMethod      = 'POST'\n\t\tHeaders     = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t\tContentType = 'application/json'\n\t\tBody        = @{\n\t\t\tdata = [PSCustomObject]@{\n\t\t\t\t\"$($Key)\" = $InputObject\n\t\t\t}\n\t\t} | ConvertTo-Json -Depth 100\n\t}\n\n\ttry {\n\t\t$null = Invoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"Bucket [$($BucketId)] data updated.\"\n\t}\n\tcatch {\n\t\tthrow \"There was an issue updating bucket [$($BucketId)] data.\"\n\t\t$_\n\t}\n}\n\n# MARK: Get-xyOpsCache\nfunction Get-xyOpsCache {\n\t<#\n\t.SYNOPSIS\n\t\tGets data from the cache bucket.\n\t\n\t.DESCRIPTION\n\t\tUses the get_bucket API to retrieve JSON data from a bucket configured for cache.\n\n\t.PARAMETER Key\n\t\tThe key of the cached item you want to retrieve from the cache bucket.\n\t\n\t.EXAMPLE\n\t\t$Countries = Get-xyOpsCache -Key Countries\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true)][string]$Key\n\t)\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Cache is currently unavailable.\"\n\t}\n\n\t$cacheBucketId = $Script:xyOps.secrets.\"$($Script:xyOps.params.cachebucketidvariable)\"\n\n\ttry {\n\t\t$bucketData = Get-xyOpsBucketData -BucketId $cacheBucketId\n\t\t$cacheData = $bucketData.\"$($Key)\"\n\t}\n\tcatch {\n\t\t$_\n\t}\n\n\treturn $cacheData\n}\n\n# MARK: Set-xyOpsCache\nfunction Set-xyOpsCache {\n\t<#\n\t.SYNOPSIS\n\t\tSets data in the cache bucket.\n\t\n\t.DESCRIPTION\n\t\tUses the write_bucket API to write a JSON converted object to a bucket data configured for cache.\n\n\t.PARAMETER Key\n\t\tThe key of the cache item you want to set.\n\n\t.PARAMETER InputObject\n\t\tThe input object you want to save in the cache bucket data.\n\t\n\t.EXAMPLE\n\t\tSet-xyOpsCache -Key Countries -InputObject @('Canada','United States','United Kingdom')\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][string]$Key,\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 1)][object]$InputObject\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Cache is currently unavailable.\"\n\t}\n\n\t$cacheApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$cacheBucketId = $Script:xyOps.secrets.\"$($Script:xyOps.params.cachebucketidvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/write_bucket_data/v1?id=$($cacheBucketId)\"\n\n\t$requestSplat = @{\n\t\tUri         = $apiUri\n\t\tMethod      = 'POST'\n\t\tHeaders     = @{\n\t\t\t'X-API-KEY' = $cacheApiKey\n\t\t}\n\t\tContentType = 'application/json'\n\t\tBody        = @{\n\t\t\tdata = [PSCustomObject]@{\n\t\t\t\t\"$($Key)\" = $InputObject\n\t\t\t}\n\t\t} | ConvertTo-Json -Depth 100\n\t}\n\n\ttry {\n\t\t$null = Invoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"Cache [$($Key)] updated.\"\n\t}\n\tcatch {\n\t\tthrow \"There was an issue updating cache [$($Key)].\"\n\t\t$_\n\t}\n}\n\n# MARK: Get-xyOpsParam\nfunction Get-xyOpsParam {\n\t<#\n\t.SYNOPSIS\n\t\tGets a parameter value from xyOps or environment variable.\n\t\n\t.DESCRIPTION\n\t\tRetrieves a parameter value, checking both the params object and environment variables. Environment variables are checked first. When called without a Name parameter, displays all available parameters in a formatted table.\n\t\n\t.PARAMETER Name\n\t\tThe parameter name to retrieve. If omitted, displays all available parameters.\n\n\t.EXAMPLE\n\t\t$timeout = Get-xyOpsParam -Name \"timeout\"\n\t\t$apiKey = Get-xyOpsParam -Name \"api_key\"\n\t\n\t.EXAMPLE\n\t\tGet-xyOpsParam\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $false)][string]$Name\n\t)\n\n\t# If no name specified, display all parameters\n\tif ([string]::IsNullOrEmpty($Name)) {\n\t\t$paramList = [System.Collections.Generic.List[object]]::new()\n\t\t\n\t\t# Collect environment variables\n\t\t$envVars = [Environment]::GetEnvironmentVariables()\n\t\tforeach ($key in $envVars.Keys) {\n\t\t\t[void]$paramList.Add([PSCustomObject]@{\n\t\t\t\t\tSource = \"Environment\"\n\t\t\t\t\tName   = $key\n\t\t\t\t\tValue  = $envVars[$key]\n\t\t\t\t})\n\t\t}\n\t\t\n\t\t# Collect xyOps params\n\t\tif ($Script:xyOps.params) {\n\t\t\t$Script:xyOps.params.PSObject.Properties | ForEach-Object {\n\t\t\t\t[void]$paramList.Add([PSCustomObject]@{\n\t\t\t\t\t\tSource = \"xyOps\"\n\t\t\t\t\t\tName   = $_.Name\n\t\t\t\t\t\tValue  = $_.Value\n\t\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\t\n\t\t# Display as formatted table\n\t\treturn $paramList | Format-Table -Property Source, Name, Value -AutoSize\n\t}\n\n\t# Check environment variable first (xyOps passes params as env vars)\n\t$envValue = [Environment]::GetEnvironmentVariable($Name)\n\tif ($null -ne $envValue) {\n\t\treturn $envValue\n\t}\n\t\n\t# Check params object\n\tif ($Script:xyOps.params.$Name) {\n\t\treturn $Script:xyOps.params.$Name\n\t}\n\t\n\treturn $null\n}\n\n# MARK: Get-xyOpsTags\nfunction Get-xyOpsTags {\n\t<#\n\t.SYNOPSIS\n\t\tGets available system tags.\n\t\n\t.DESCRIPTION\n\t\tGets available system tags using the get_tags API. Optionally, you can supply tag titles so that only those are returned.\n\n\t.PARAMETER Tags\n\t\tOptionally supply a list of tag titles as an array or list. If the tags exist, they will be returned.\n\t\n\t.EXAMPLE\n\t\tGet-xyOpsTags\n\t\n\t.EXAMPLE\n\t\tGet-xyOpsTags -Tags @('Canada','United States','United Kingdom')\n\t\n\t.EXAMPLE\n\t\tGet-xyOpsTags 'John','Joe','Jill','Jane'\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $false, ValueFromPipeline = $true, Position = 0)][System.Collections.Generic.List[string]]$Tags\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Tags access is currently unavailable.\"\n\t}\n\n\t$bucketApiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.bucketapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/get_tags/v1\"\n\n\t$requestSplat = @{\n\t\tUri     = $apiUri\n\t\tMethod  = 'GET'\n\t\tHeaders = @{\n\t\t\t'X-API-KEY' = $bucketApiKey\n\t\t}\n\t}\n\n\ttry {\n\t\t$allTags = (Invoke-RestMethod @requestSplat).rows\n\t}\n\tcatch {\n\t\t$_\n\t}\n\n\tif ($Tags) {\n\t\t$returnTags = [System.Collections.Generic.List[object]]::new()\n\n\t\tforeach ($tag in $allTags) {\n\t\t\tif ($tag.title -in $Tags) {\n\t\t\t\t$returnTags.Add($tag)\n\t\t\t}\n\t\t}\n\n\t\treturn $returnTags\n\t}\n\n\treturn $allTags\n}\n\n# MARK: Send-xyOpsTags\nfunction Send-xyOpsTags {\n\t<#\n\t.SYNOPSIS\n\t\tPushes tags to the job output.\n\t\n\t.DESCRIPTION\n\t\tPushes one or more tags to be appended to the job output. The tags are provided as an array or list of tag names. Available tags are retrieved from the system to get the ID, which is used by xyOps to apply the correct tag.\n\t\n\t.PARAMETER Tags\n\t\tAn array or list of tag titles or IDs to be set on the job. The tags must exist in the xyOps tags configuration, otherwise they will be ignored.\n\n\t.EXAMPLE\n\t\tSend-xyOpsTags -Tags @('Canada','United States','United Kingdom')\n\t\n\t.EXAMPLE\n\t\tSend-xyOpsTags 'John','Joe','Jill','Jane'\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true, ValueFromPipeline = $true, Position = 0)][System.Collections.Generic.List[string]]$Tags\n\t)\n\n\ttry {\n\t\t$systemTags = [System.Collections.Generic.List[object]](Get-xyOpsTags)\n\t}\n\tcatch {\n\t\tthrow $_\n\t}\n\n\t$pushTags = [System.Collections.Generic.List[object]]::new()\n\n\tforeach ($tag in $Tags) {\n\t\tswitch ($tag) {\n\t\t\t{ $_ -in $systemTags.title } {\n\t\t\t\t$pushTags.Add(($systemTags.Find({ $args.title -eq $tag })).id)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\t{ $_ -in $systemTags.id } {\n\t\t\t\t$pushTags.Add($tag)\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tdefault {\n\t\t\t\tWrite-xyOpsJobOutput -Message \"[Send-xyOpsTags] The tag '$($tag)' does not exist. Create the tag under [Scheduler > Tags].\"\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\tpush = @{\n\t\t\t\ttags = $pushTags\n\t\t\t}\n\t\t})\n}\n\n# MARK: Send-xyOpsEmail\nfunction Send-xyOpsEmail {\n\t<#\n\t.SYNOPSIS\n\t\tSend an email using the built-in xyOps mechanism.\n\t\n\t.DESCRIPTION\n\t\tSends an email using the built-in xyOps mechanism and configuration.\n\n\t.PARAMETER To\n\t\tThe email address of the recipient. Multiple recipients should be comma-separated.\n\t\n\t.PARAMETER Subject\n\t\tThe email subject.\n\n\t.PARAMETER Body\n\t\tThe email body. This parameter is processed as Markdown so your body text can be formatted using Markdown syntax. This also means\n\t\tyou can supply pure HTML as Markdown supports HTML directly.\n\n\t.PARAMETER CC\n\t\tThe email address(es) of the recipient(s) to CC. Multiple recipients should be comma-separated.\n\t\t\n\t.PARAMETER BCC\n\t\tThe email address(es) of the recipient(s) to CCC. Multiple recipients should be comma-separated.\n\n\t.PARAMETER Title\n\t\tTitle text that will be displayed at the top of the email in larger text.\n\n\t.PARAMETER ButtonLabel\n\t\tThe label used in the optional button. Include this parameter to include a button in the top-right corner of the email.\n\n\t.PARAMETER ButtonUri\n\t\tThe Uri to where the button will link to.\n\n\t.PARAMETER Importance\n\t\tSet the importance of the email. Choose between low, normal and high. This is set to normal by default.\n\n\t.PARAMETER Attachments\n\t\tProvide an array or list of file paths to files that you want to attach to the email.\n\n\t.EXAMPLE\n\t\tSend-xyOpsEmail -To \"user@domain.com\" -Subject \"Important Email Update\" -Body \"This is a test!\" -Importance high\n\n\t.EXAMPLE\n\t\tSend-xyOpsEmail -To \"user@domain.com\" -Subject \"Reports\" -Body \"Please see attached.\" -Attachments './report1.pdf','./report_final.pdf'\n\t#>\n\t[CmdletBinding()]\n\tparam(\n\t\t[Parameter(Mandatory = $true)][string]$To,\n\t\t[Parameter(Mandatory = $true)][string]$Subject,\n\t\t[Parameter(Mandatory = $true)][string]$Body,\n\t\t[Parameter(Mandatory = $false)][System.Collections.Generic.List[object]]$CC,\n\t\t[Parameter(Mandatory = $false)][System.Collections.Generic.List[object]]$BCC,\n\t\t[Parameter(Mandatory = $false)][string]$Title,\n\t\t[Parameter(Mandatory = $false)][string]$ButtonLabel,\n\t\t[Parameter(Mandatory = $false)][string]$ButtonUri,\n\t\t[Parameter(Mandatory = $false)][ValidateSet('low', 'normal', 'high')][string]$Importance = 'normal',\n\t\t[Parameter(Mandatory = $false)][System.Collections.Generic.List[object]]$Attachments\n\t)\n\n\tif ([string]::IsNullOrEmpty($Script:xyOps.Secrets)) {\n\t\tthrow \"No secrets have been assigned to this plugin or event. Email access is currently unavailable.\"\n\t}\n\n\t$apiKey = $Script:xyOps.secrets.\"$($Script:xyOps.params.sendemailapikeyvariable)\"\n\t$apiUri = \"$($Script:xyOps.base_url)/api/app/send_email/v1\"\n\n\t$requestSplat = @{\n\t\tUri         = $apiUri\n\t\tMethod      = 'POST'\n\t\tHeaders     = @{\n\t\t\t'X-API-KEY' = $apiKey\n\t\t}\n\t\tContentType = 'multipart/form-data'\n\t\tForm        = @{\n\t\t\tjson = @{\n\t\t\t\tto      = $To\n\t\t\t\tsubject = $Subject\n\t\t\t\tbody    = $Body\n\t\t\t\tcc      = $CC -join ','\n\t\t\t\tbcc     = $BCC -join ','\n\t\t\t\ttitle   = $Title\n\t\t\t\tbutton  = (-not [string]::IsNullOrEmpty($ButtonLabel) -and -not [string]::IsNullOrEmpty($ButtonUri)) ? \"$($ButtonLabel) | $($ButtonUri)\" : $null\n\t\t\t\theaders = @{\n\t\t\t\t\tImportance          = $Importance\n\t\t\t\t\t'X-MSMail-Priority' = switch ($Importance) {\n\t\t\t\t\t\t'low' { 5 }\n\t\t\t\t\t\t'normal' { 3 }\n\t\t\t\t\t\t'high' { 1 }\n\t\t\t\t\t}\n\t\t\t\t\t'X-Priority'        = switch ($Importance) {\n\t\t\t\t\t\t'low' { 5 }\n\t\t\t\t\t\t'normal' { 3 }\n\t\t\t\t\t\t'high' { 1 }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} | ConvertTo-Json -Depth 100\n\t\t}\n\t}\n\n\tif ($Attachments.Count -gt 0) {\n\t\t$counter = 0\n\t\tforeach ($attachment in $Attachments) {\n\t\t\t$counter++\n\t\t\t$requestSplat.Form[\"file$($counter)\"] = (Get-Item -Path $attachment)\n\t\t}\n\t}\n\n\ttry {\n\t\t$null = Invoke-RestMethod @requestSplat\n\t\tWrite-xyOpsJobOutput \"Email Sent\"\n\t}\n\tcatch {\n\t\tthrow \"There was an issue sending the email.\"\n\t\t$_\n\t}\n}\n\n# MARK: Begin\n\n# Read job parameters from JSON input\n[PSCustomObject]$Script:xyOps = ConvertFrom-Json -Depth 100 (Read-Host)\n\ntry {\n\t$command = [scriptblock]::create($Script:xyOps.params.command)\n}\ncatch {\n\tthrow \"The code block provided is invalid. Please use a proper code editor to verify your script.\"\n}\n\n$Script:enableLogTime = $Script:xyOps.params.logtime\n\nif ($Script:xyOps.input -and ($Script:xyOps.params.passdata -eq $true)) {\n\tif ($Script:xyOps.input.data) {\n\t\tSend-xyOpsData $Script:xyOps.input.data\n\t}\n\telse {\n\t\tSend-xyOpsData $Script:xyOps.input\n\t}\n}\n\n# Set current directory to the working directory of the job\nSet-Location $Script:xyOps.cwd\n\n# Output xyOps Json data\nif ($Script:xyOps.params.outputxyops) {\n\t$formattedJson = $Script:xyOps | ConvertTo-Json -Depth 100\n\t$markdownContent = \"``````json`n$($formattedJson)`n``````\"\n\tSend-xyOpsMarkdown -Content $markdownContent -Title \"Job Data - Json\"\n}\n\n# Output PowerShell Version\nWrite-xyOpsJobOutput \"PowerShell Version: $($PSVersionTable.PSVersion)\"\n\n# Import any .psm1 module files provided from a bucket fetch action.\nif ($Script:xyOps.params.processmodules) {\n\t$moduleFiles = Get-xyOpsInputFiles | Where-Object { $_.filename -like \"*.psm1\" }\n\tforeach ($moduleFile in $moduleFiles) {\n\t\ttry {\n\t\t\tWrite-xyOpsJobOutput \"Loading module file: $($moduleFile.filename)\" -Level info\n\t\t\tImport-Module \"./$($moduleFile.filename)\"\n\t\t}\n\t\tcatch {\n\t\t\tWrite-xyOpsJobOutput $_ -Level error\n\t\t}\n\t}\n}\n\nWrite-xyOpsJobOutput 'Job Started'\n\ntry {\n\n\t& $command\n\n\t# Report success\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy   = 1\n\t\t\tcode = 0\n\t\t})\n}\ncatch {\n\t# Write out error details\n\tWrite-xyOpsJobOutput \"Error:\" -Level error\n\tWrite-xyOpsJobOutput $_ -Level error\n\tWrite-xyOpsJobOutput \"Exception:\" -Level error\n\tWrite-xyOpsJobOutput $_.Exception -Level error\n\n\t# Report failure\n\tSend-xyOpsOutput ([pscustomobject]@{\n\t\t\txy          = 1\n\t\t\tcode        = 999\n\t\t\tdescription = \"Job failed!\"\n\t\t})\n}\nfinally {\n\tWrite-xyOpsJobOutput 'Job Finished'\n}",
				"groups": [],
				"format": "",
				"params": [
					{
						"id": "command",
						"title": "Code Block",
						"type": "code",
						"caption": "A code block that contains the PowerShell script code to be executed.",
						"locked": false,
						"value": "# PowerShell script code goes here\n",
						"required": true
					},
					{
						"id": "logtime",
						"title": "Enable Time in Output",
						"type": "checkbox",
						"caption": "Enables a timestamp on each output line when using the Log helper function",
						"locked": false,
						"value": true
					},
					{
						"id": "outputxyops",
						"title": "Output xyOps JSON Data",
						"type": "checkbox",
						"caption": "Output the job JSON data as markdown formatted in the job output. USE WITH CAUTION as this will contain any included secret variables in clear-text.",
						"locked": true,
						"value": false
					},
					{
						"id": "processmodules",
						"title": "Process Module Files",
						"type": "checkbox",
						"caption": "Import all .psm1 files attached to the job input. These files can be manually uploaded each time or added to a bucket to be referenced by a 'Fetch Bucket' action.",
						"locked": false,
						"value": true
					},
					{
						"id": "passdata",
						"title": "Data Passthrough",
						"type": "checkbox",
						"caption": "If checked, data output from one event will pass through automatically to its output. Note that if an event outputs the same data property as existing data that was passed in, it will overwrite what was passed into it.",
						"locked": false,
						"value": false
					},
					{
						"id": "bucketapikeyvariable",
						"title": "Bucket API Key Variable Name",
						"type": "text",
						"caption": "The secret vault variable name used for the API Key for accessing buckets. See 'Setting Up Cache Bucket' section of the plugin readme.",
						"locked": true,
						"value": "XYOPS_BUCKET_API_KEY",
						"variant": "text",
						"required": false
					},
					{
						"id": "cachebucketidvariable",
						"title": "Cache Bucket ID Variable Name",
						"type": "text",
						"caption": "The secret vault variable name used for the Bucket ID when configuring the cache bucket setup. See 'Setting Up Cache Bucket' section of the plugin readme.",
						"locked": true,
						"value": "XYOPS_CACHE_BUCKET_ID",
						"variant": "text",
						"required": false
					},
					{
						"id": "sendemailapikeyvariable",
						"title": "Send Email API Key Variable Name",
						"type": "text",
						"caption": "The secret vault variable name used for the API Key for sending emails. See 'Setting Up Email API Key' section of the plugin readme.",
						"locked": true,
						"value": "XYOPS_SENDEMAIL_API_KEY",
						"variant": "text",
						"required": false
					}
				],
				"kill": "parent",
				"runner": false,
				"notes": "",
				"icon": "powershell",
				"uid": "",
				"gid": ""
			}
		}
	]
}